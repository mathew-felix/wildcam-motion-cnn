# =============================================================================
# ViBe evaluation config (AT + ALR)
# =============================================================================
# This config runs ViBe motion detection on the videos listed in `manifest_path`,
# computes frame-level TP/FP/FN/TN + precision/recall + FPS, and writes results
# to `output_csv`.
#
# Variant enabled here:
#   - AT  (Adaptive Thresholding): dynamic min_matches based on mean intensity
#   - ALR (Adaptive Learning Rate): dynamic update rate based on motion intensity
# =============================================================================

# Path to manifest describing your benchmark videos and GT annotation files.
# Can be relative to repo root or to the config directory (depending on your runner).
manifest_path: data/benchmarks/manifest.json

# Output CSV path. Relative paths are interpreted relative to this YAML file’s directory.
output_csv: ../results/vibe_AT_ALR.csv

# Optionally evaluate only a subset of videos by their manifest "id".
# Use null to evaluate all.
only_ids: null   # e.g. ["Test_Deer_Day"]

# Seed for reproducible randomness in ViBe (initial sampling + stochastic updates).
rng_seed: 0

# =============================================================================
# Evaluation window / warmup
# =============================================================================
eval:
  # Start time (seconds) of the evaluation region within the video.
  # Use 0.0 to evaluate from the beginning.
  start_sec: 0.0

  # End time (seconds). Use null to evaluate until end of video.
  end_sec: null

  # Warmup duration (seconds): frames processed but NOT scored.
  # Background subtractors like ViBe need this to stabilize.
  warmup_sec: 2.0

# =============================================================================
# Preprocessing (what frame is fed to ViBe)
# =============================================================================
preprocess:
  # ViBe expects grayscale. Keep true unless you implement a color ViBe variant.
  grayscale: true

  # Resize frames to this width (keeps aspect ratio).
  # Smaller width => faster FPS but potentially worse detection quality.
  resize_width: 640

# =============================================================================
# ViBe parameters
# =============================================================================
vibe:
  # Number of samples stored per pixel (larger => more stable, slower, more memory).
  num_samples: 20

  # Pixel match threshold in grayscale intensity:
  # Smaller => stricter match => more FG (more sensitivity, more FP)
  # Larger  => easier match => more BG (less sensitivity, more FN)
  radius: 20

  # BASELINE model update probability:
  # update probability ≈ 1 / subsampling_factor
  # Larger => slower adaptation (good to avoid absorbing moving animals, but may keep stale BG)
  subsampling_factor: 16

  # ---------------------------------------------------------------------------
  # Baseline fixed decision threshold (used only if adaptive_min_matches = false)
  # ---------------------------------------------------------------------------
  # Minimum number of matching samples required to label a pixel as BACKGROUND.
  # Larger min_matches => stricter BG decision => more FG (higher recall, lower precision)
  min_matches: 2

  # ---------------------------------------------------------------------------
  # AT: Adaptive Thresholding (dynamic min_matches)
  # ---------------------------------------------------------------------------
  # Goal: handle day vs night/IR differences by adjusting sensitivity using mean intensity.
  adaptive_min_matches: true

  # Mean intensity mapping:
  #   mean <= intensity_min  -> min_matches_min
  #   mean >= intensity_max  -> min_matches_max
  # If night scenes are darker, this mapping changes how strict the BG decision is at night.
  intensity_min: 40.0
  intensity_max: 160.0

  # Range of min_matches allowed under AT.
  # IMPORTANT: higher min_matches => MORE FG (more sensitive).
  min_matches_min: 1
  min_matches_max: 4

  # EMA smoothing of mean intensity to avoid min_matches flickering.
  intensity_ema_alpha: 0.2

  # ---------------------------------------------------------------------------
  # ALR: Adaptive Learning Rate (adaptive background update rate)
  # ---------------------------------------------------------------------------
  # Goal: update slower when motion is high (avoid absorbing animals),
  # and update faster when scene is stable (adapt to slow illumination drift).
  adaptive_update: true

  # Motion intensity is estimated as fg_ratio = (#FG pixels) / (H*W), in [0,1].
  # fg_ratio <= motion_low  -> update_sf_min (fast updates)
  # fg_ratio >= motion_high -> update_sf_max (slow updates)
  motion_low: 0.001
  motion_high: 0.05

  # Bounds for dynamic update subsampling_factor:
  # Smaller => more frequent updates (faster learning)
  # Larger  => fewer updates (slower learning)
  update_sf_min: 8
  update_sf_max: 64

  # EMA smoothing for fg_ratio to prevent update rate flicker.
  motion_ema_alpha: 0.2

# =============================================================================
# Post-processing + motion decision threshold (frame-level)
# =============================================================================
postprocess:
  # Median blur cleans salt-and-pepper noise in FG mask.
  # Must be odd >= 3; set 0 to disable.
  median_blur_ksize: 3

  # Morphology to remove small speckles and connect blobs.
  # Typical: erode then dilate (opening) for noise removal,
  # or dilate more to connect nearby motion regions.
  erode_iters: 1
  dilate_iters: 2

  # Motion decision rule: choose ONE threshold type.
  # - min_fg_pixels: absolute FG pixels needed to mark frame as "motion"
  # - min_fg_ratio : fraction of pixels needed (resolution-independent)
  #
  # Higher threshold => fewer motion frames (higher precision, higher saved%, lower recall)
  # Lower threshold  => more motion frames (higher recall, lower saved%, lower precision)
  min_fg_pixels: 500
  min_fg_ratio: null

# =============================================================================
# UI / debugging
# =============================================================================
ui:
  # Show progress bars for videos/frames.
  # NOTE: if show_debug is true, tqdm is automatically disabled.
  use_tqdm: true

  # If true: opens an OpenCV window showing (frame | mask).
  # Useful for debugging mask quality, but slows runtime and disables tqdm.
  show_debug: false
