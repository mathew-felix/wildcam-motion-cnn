# =============================================================================
# ViBe + MHI (HIGH-RECALL) — aim: maximize behavior capture (accept more kept frames)
# =============================================================================
# Key ideas:
# - Start recording aggressively (fix deer_day misses)
# - Use longer MHI memory + longer post-roll to bridge pauses (captures full behavior)
# - AT + ALR ON (best chance to reduce FN across day/night)
# =============================================================================

manifest_path: data/benchmarks/manifest.json
output_csv: ../results/vibe_mhi_high_recall.csv

only_ids: null
rng_seed: 0

eval:
  start_sec: 0.0
  end_sec: null
  warmup_sec: 2.0

preprocess:
  grayscale: true
  resize_width: 640

vibe:
  num_samples: 20
  radius: 20
  subsampling_factor: 16
  min_matches: 2

  # --- AT ON ---
  adaptive_min_matches: true
  intensity_min: 40.0
  intensity_max: 160.0
  min_matches_min: 1
  min_matches_max: 4
  intensity_ema_alpha: 0.2

  # --- ALR ON ---
  adaptive_update: true
  motion_low: 0.001
  motion_high: 0.05
  update_sf_min: 8
  update_sf_max: 64
  motion_ema_alpha: 0.2

postprocess:
  median_blur_ksize: 3
  erode_iters: 1
  dilate_iters: 2

# Keep filtering, but less aggressive than balanced so small animals aren't dropped
components:
  min_blob_area: 200     # try 120–300 depending on animal size and wind noise
  max_blobs: 3

mhi:
  enabled: true
  tau_sec: 1.2           # longer memory bridges pauses (try 1.0–1.5)
  recent_thresh: 0.25

gate:
  enabled: true

  # START (aggressive): start fast to reduce FN
  start_metric: vibe_fg_pixels
  start_threshold: 550.0
  start_consecutive: 1

  # STAY (lenient): keep while any motion history remains + longer post-roll
  stay_metric: mhi_active_ratio
  stay_threshold: 0.0010

  pre_roll_sec: 0.0
  post_roll_sec: 1.5

ui:
  use_tqdm: true
  show_debug: false
