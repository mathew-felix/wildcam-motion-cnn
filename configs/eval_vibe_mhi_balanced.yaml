# =============================================================================
# ViBe + MHI (BALANCED) — aim: good recall without fox_night "always recording"
# =============================================================================
# Key ideas:
# - Start recording a bit easier than your first MHI config (fix deer_day misses)
# - Use blob filtering + shorter MHI memory to avoid wind/grass accumulation (fix fox_night latch)
# - Use AT (illumination-aware) but keep ALR off in this balanced preset
# =============================================================================

manifest_path: data/benchmarks/manifest.json
output_csv: ../results/vibe_mhi_balanced.csv

only_ids: null
rng_seed: 0

eval:
  start_sec: 0.0
  end_sec: null
  warmup_sec: 2.0

preprocess:
  grayscale: true
  resize_width: 640

vibe:
  num_samples: 20
  radius: 20
  subsampling_factor: 16
  min_matches: 2

  # --- AT ON (recommended) ---
  adaptive_min_matches: true
  intensity_min: 40.0
  intensity_max: 160.0
  min_matches_min: 1
  min_matches_max: 4
  intensity_ema_alpha: 0.2

  # --- ALR OFF (balanced preset) ---
  adaptive_update: false
  motion_low: 0.001
  motion_high: 0.05
  update_sf_min: 8
  update_sf_max: 64
  motion_ema_alpha: 0.2

postprocess:
  median_blur_ksize: 3
  erode_iters: 1
  dilate_iters: 2

# BEFORE MHI update: remove speckles + keep only biggest blobs (prevents MHI latching)
components:
  min_blob_area: 350     # increase to suppress wind/grass speckles (try 250–600)
  max_blobs: 2           # keep only top-K largest blobs

mhi:
  enabled: true
  tau_sec: 0.8           # shorter memory reduces latch (try 0.6–1.0)
  recent_thresh: 0.35    # focus on recent motion for the stay signal

gate:
  enabled: true

  # START (strict-ish): easier than your first MHI config to reduce deer_day FN
  start_metric: vibe_fg_pixels
  start_threshold: 650.0
  start_consecutive: 2

  # STAY (lenient, but "recent" to avoid background noise persistence)
  stay_metric: mhi_recent_ratio
  stay_threshold: 0.0015

  pre_roll_sec: 0.0
  post_roll_sec: 0.8

ui:
  use_tqdm: true
  show_debug: false
